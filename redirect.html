<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ezidi-ID Redirect</title>
  <style>
    body { font-family: -apple-system, system-ui, sans-serif; padding: 24px; }
    .box { max-width: 560px; margin: 0 auto; }
    a.btn { display:inline-block; padding:12px 16px; border-radius:12px; background:#111; color:#fff; text-decoration:none; }
    code { background:#f2f2f2; padding:2px 6px; border-radius:6px; }
    .muted { color:#666; font-size: 14px; }
    .warn { color:#b00; font-weight: 600; }
  </style>
</head>
<body>
  <div class="box">
    <h2>Ezidi-ID</h2>
    <p class="muted">Wenn du diesen Text siehst, wird die Seite korrekt geladen ✅</p>

    <p><b>Code:</b> <code id="code">(kein code)</code></p>
    <p><b>DeepLink:</b> <code id="deeplink">(wird berechnet)</code></p>

    <p id="status" class="muted">Status: bereit</p>

    <p><a id="openBtn" class="btn" href="#">App öffnen</a></p>

    <p class="muted">
      iOS öffnet Apps meistens nur nach einem Klick.
      Wenn es nicht klappt, kopiere den DeepLink und öffne ihn in Safari.
    </p>

    <p id="jsinfo" class="warn"></p>

    <details class="muted">
      <summary>Technische Details</summary>
      <pre id="debug"></pre>
    </details>
  </div>

  <script>
    // Wenn JS NICHT läuft, bleibt die Seite trotzdem sichtbar.
    (function () {
      try {
        const url = new URL(window.location.href);
        const code = url.searchParams.get("code") || "";
        const deepLink = "ezidiid://reset-password?code=" + encodeURIComponent(code);

        document.getElementById("code").textContent = code || "(leer)";
        document.getElementById("deeplink").textContent = deepLink;

        const dbg =
          "href: " + window.location.href + "\n" +
          "search: " + window.location.search + "\n" +
          "hash: " + window.location.hash + "\n";
        document.getElementById("debug").textContent = dbg;

        const btn = document.getElementById("openBtn");
        btn.href = deepLink;

        const status = document.getElementById("status");
        status.textContent = "Status: tippe auf „App öffnen“.";

        // Kein Auto-Redirect (macht oft nur "weiß", wenn iOS blockt)
      } catch (e) {
        document.getElementById("jsinfo").textContent =
          "JS Fehler: " + e;
      }
    })();
  </script>
</body>
</html>
